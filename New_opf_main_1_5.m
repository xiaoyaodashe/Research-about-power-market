%%% Part program of the article 'A LR-ACOPF Based Market Clearing Model and LMP Decomposition'.
%%% Article URL: https://kns.cnki.net/KXReader/Detail?TIMESTAMP=637575376450175781&DBCODE=CAPJ&TABLEName=CAPJLAST&FileName=ZGDC20200727002&RESULT=1&SIGN=Hxxpzgo77zBOVwflwRYGPwzup4k%3d
%%% New 线性潮流计算方法
%%% by Yao Xiao
%%% xiaoyaodashe@outlook.com
%%% yao.xiao.1@stonybrook.edu
%%%本版本基于New_opf_main_1_3_prde_activepowercompara,改成电压线性松弛，角度线性松弛
%% ---- 生成导纳矩阵等信息 -------------------------------------------------
%导入电网数据
mpc=ext2int(case39xy_LMPDecomposition);%case39xy_Q);
[baseMVA,bus,gen,branch,gencost]=deal(mpc.baseMVA,mpc.bus,mpc.gen,mpc.branch,mpc.gencost);
%生成导纳矩阵
Ybus=makeYbus(baseMVA,bus,branch);
Gbus=real(Ybus);%实部
Bbus=imag(Ybus);%虚部
%其他信息
[PQ, PV, REF, NONE, BUS_I, BUS_TYPE, PD, QD, GS, BS, BUS_AREA, VM, ...
    VA, BASE_KV, ZONE, VMAX, VMIN, LAM_P, LAM_Q, MU_VMAX, MU_VMIN] = idx_bus;%母线参数列号
[GEN_BUS, PG, QG, QMAX, QMIN, VG, MBASE, GEN_STATUS, PMAX, PMIN, ...
    MU_PMAX, MU_PMIN, MU_QMAX, MU_QMIN, PC1, PC2, QC1MIN, QC1MAX, ...
    QC2MIN, QC2MAX, RAMP_AGC, RAMP_10, RAMP_30, RAMP_Q, APF] = idx_gen;%发电机参数列号
[PW_LINEAR, POLYNOMIAL, MODEL, STARTUP, SHUTDOWN, NCOST, COST] = idx_cost;%发电机成本参数列号
[F_BUS, T_BUS, BR_R, BR_X, BR_B, RATE_A, RATE_B, ...
    RATE_C, TAP, SHIFT, BR_STATUS, PF, QF, PT, QT, MU_SF, MU_ST, ...
    ANGMIN, ANGMAX, MU_ANGMIN, MU_ANGMAX] = idx_brch;%母线参数列号
[ref, pv, pq] = bustypes(bus,gen);%节点类型
nbus=size(bus,1);%母线数量
branch=branch(branch(:,BR_STATUS)==1,:);
nbranch=size(branch,1);
gen=gen(gen(:,GEN_STATUS)==1,:);
ng=size(gen,1);%发电机数量
No_ref=[1:ref-1,ref+1:nbus];%非参考节点
%负荷值
sumpload=[3959];%	3733	3280	3016	3129	3393	3959	4411	4637	4977	5033	4751	4524	4298	4977	5090	4807	5033	5116	5184	5090	5014	4901	4581];
Pload=bus(:,PD).*sumpload/sumpload(1);
Qload=bus(:,QD).*sumpload/sumpload(1);
%时间段数量
nt=size(sumpload,2);
%容量参数
Pmax=gen(:,PMAX);
Pmin=gen(:,PMIN);
Qmax=gen(:,QMAX);
Qmin=gen(:,QMIN);
%取出唯一的线路编号
unibranch=unique(branch(:,1:2),'rows');
nunibranch=size(unibranch,1);%去掉重复后的线路数量

%%---- 定义变量 ------------------------------------------------------------
V_2=sdpvar(nbus,nt,'full');
theta=sdpvar(nbus,nt,'full');
theta_xi=sdpvar(nunibranch,nt,'full');
theta_vi=sdpvar(nunibranch,nt,'full');
theta_ti=sdpvar(nunibranch,nt,'full');
P=sdpvar(ng,nt,'full');
Q=sdpvar(ng,nt,'full');

%%---- 关联矩阵 ------------------------------------------------------------
Vgen_bus=sparse(gen(:,1),1:ng,1,nbus,ng);
VFunibranch_bus=sparse(unibranch(:,1),1:nunibranch,1,nbus,nunibranch);
VTunibranch_bus=sparse(unibranch(:,2),1:nunibranch,1,nbus,nunibranch);
VFTunibranch_bus_sum=VFunibranch_bus+VTunibranch_bus;
VFTunibus_branch_sum=VFunibranch_bus'+VTunibranch_bus';
VFTunibus_branch_diff=VFunibranch_bus'-VTunibranch_bus';
VFbus_branch=sparse(1:nbranch,branch(:,1),1,nbranch,nbus);
VTbus_branch=sparse(1:nbranch,branch(:,2),1,nbranch,nbus);
VFTbus_branch_diff=VFbus_branch-VTbus_branch;
VFTbus_branch_sum=VFbus_branch+VTbus_branch;

%%---- 辅助矩阵+参数 -------------------------------------------------------
%形成Bbus_矩阵
Bbus_=-Bbus;
Bbus_(logical(eye(nbus,nbus)))=sum(Bbus.*(1-eye(nbus,nbus)),2);
%形成Gbus_矩阵
Gbus_=Gbus;
Gbus_(logical(eye(nbus,nbus)))=-sum(Gbus.*(1-eye(nbus,nbus)),2);
% %形成发电机功率极限参数(瞎设的)
% alpha1=Pmax./(Qmin/4-Qmax/4);
% alpha2=Pmax./(Qmax/4-Qmin/4);
%ref,pv,节点电压约束
V_2_ref=bus(ref,VM).^2;
% V_2_pv=bus(pv,VM).^2;
V_2_MAX=bus(:,VMAX).^2;
V_2_MIN=bus(:,VMIN).^2;
%参考节点相角约束
theta_ref=bus(ref,VA)*pi/180;
%形成松弛不等式参数
% a_n=[-0.499999651672494,-0.503180985617645,-0.506362319562458,-0.509543653507336,-0.512724987452188,-0.515906321397168,-0.519087655342076,-0.522268989286934,-0.525450323231819,-0.528631657176629,-0.531812991121588,-0.534994325066543,-0.538175659011399,-0.541356992956257,-0.544538326901100,-0.547719660845980,-0.550900994790916,-0.554082328735800,-0.557263662680735,-0.560444996625523,-0.496838435898428,-0.499999656063158,-0.503160876227842,-0.506322096392885,-0.509483316557545,-0.512644536722361,-0.515805756887130,-0.518966977051928,-0.522128197216672,-0.525289417381577,-0.528450637546297,-0.531611857711169,-0.534773077875819,-0.537934298040616,-0.541095518205413,-0.544256738370197,-0.547417958535028,-0.550579178699739,-0.553740398864564,-0.556901619029292,-0.493716942125850,-0.496858301248635,-0.499999660371377,-0.503141019494111,-0.506282378616873,-0.509423737739624,-0.512565096862406,-0.515706455985158,-0.518847815107883,-0.521989174230601,-0.525130533353393,-0.528271892476229,-0.531413251598973,-0.534554610721673,-0.537695969844422,-0.540837328967189,-0.543978688089889,-0.547120047212689,-0.550261406335504,-0.553402765458119,-0.490634426344121,-0.493756172429034,-0.496877918513946,-0.499999664598842,-0.503121410683981,-0.506243156768947,-0.509364902853926,-0.512486648938761,-0.515608395023686,-0.518730141108659,-0.521851887193421,-0.524973633278368,-0.528095379363275,-0.531217125448263,-0.534338871533021,-0.537460617617894,-0.540582363702830,-0.543704109787789,-0.546825855872660,-0.549947601957501,-0.487590163009375,-0.490692539444245,-0.493794915879029,-0.496897292313912,-0.499999668748326,-0.503102045183157,-0.506204421617952,-0.509306798052901,-0.512409174487808,-0.515511550922572,-0.518613927357386,-0.521716303792216,-0.524818680227051,-0.527921056661863,-0.531023433096672,-0.534125809531523,-0.537228185966468,-0.540330562401145,-0.543432938836137,-0.546535315270937,-0.484583444470926,-0.487666690140977,-0.490749935811006,-0.493833181481050,-0.496916427150983,-0.499999672821062,-0.503082918491079,-0.506166164161059,-0.509249409831089,-0.512332655501182,-0.515415901171098,-0.518499146841221,-0.521582392511141,-0.524665638181172,-0.527748883851245,-0.530832129521186,-0.533915375191242,-0.536998620861299,-0.540081866531268,-0.543165112201379,-0.481613580429558,-0.484677929827848,-0.487742279226117,-0.490806628624354,-0.493870978022654,-0.496935327420945,-0.499999676819094,-0.503064026217342,-0.506128375615565,-0.509192725014070,-0.512257074412293,-0.515321423810529,-0.518385773208782,-0.521450122607075,-0.524514472005395,-0.527578821403581,-0.530643170801924,-0.533707520200138,-0.536771869598508,-0.539836218996717,-0.478679897403035,-0.481725580737464,-0.484771264071953,-0.487816947406525,-0.490862630740836,-0.493908314075388,-0.496953997409802,-0.499999680744232,-0.503045364078926,-0.506091047413386,-0.509136730747735,-0.512182414082339,-0.515228097416693,-0.518273780751282,-0.521319464085664,-0.524365147420110,-0.527410830754740,-0.530456514089301,-0.533502197423723,-0.536547880758220,-0.475781738220334,-0.478808981517574,-0.481836224814834,-0.484863468112112,-0.487890711409420,-0.490917954706611,-0.493945198003859,-0.496972441301205,-0.499999684598557,-0.503026927895809,-0.506054171193058,-0.509081414490274,-0.512108657787656,-0.515135901084877,-0.518163144382221,-0.521190387679325,-0.524217630976609,-0.527244874273929,-0.530272117571237,-0.533299360868445,-0.472918461530320,-0.475927486736201,-0.478936511942121,-0.481945537148079,-0.484954562353934,-0.487963587559939,-0.490972612765806,-0.493981637971754,-0.496990663177668,-0.499999688383292,-0.503008713589228,-0.506017738795047,-0.509026764001058,-0.512035789206906,-0.515044814412955,-0.518053839618741,-0.521062864824726,-0.524071890030643,-0.527080915236621,-0.530089940442522,-0.470089441326664,-0.473080466404120,-0.476071491481466,-0.479062516558668,-0.482053541636231,-0.485044566713437,-0.488035591790911,-0.491026616868247,-0.494017641945612,-0.497008667022956,-0.499999692100359,-0.502990717177713,-0.505981742255154,-0.508972767332399,-0.511963792409963,-0.514954817487208,-0.517945842564688,-0.520936867641948,-0.523927892719361,-0.526918917796718,-0.467294066495077,-0.470267305518406,-0.473240544541631,-0.476213783564958,-0.479187022588215,-0.482160261611577,-0.485133500634781,-0.488106739657992,-0.491079978681411,-0.494053217704705,-0.497026456727964,-0.499999695751309,-0.502972934774631,-0.505946173797894,-0.508919412821214,-0.511892651844534,-0.514865890867881,-0.517839129891117,-0.520812368914500,-0.523785607937716,-0.464531740369933,-0.467487403617272,-0.470443066864511,-0.473398730111856,-0.476354393359195,-0.479310056606542,-0.482265719853769,-0.485221383101142,-0.488177046348520,-0.491132709595745,-0.494088372843183,-0.497044036090405,-0.499999699337636,-0.502955362585119,-0.505911025832330,-0.508866689079693,-0.511822352326908,-0.514778015574318,-0.517733678821606,-0.520689342068913,-0.461801880311445,-0.464740174353691,-0.467678468396044,-0.470616762438308,-0.473555056480502,-0.476493350522898,-0.479431644565076,-0.482369938607342,-0.485308232649590,-0.488246526691918,-0.491184820734270,-0.494123114776489,-0.497061408818696,-0.499999702860963,-0.502937996903382,-0.505876290945658,-0.508814584987879,-0.511752879030188,-0.514691173072481,-0.517629467114752,-0.459103917295466,-0.462025045083146,-0.464946172870804,-0.467867300658369,-0.470788428446115,-0.473709556233731,-0.476630684021556,-0.479551811809098,-0.482472939596842,-0.485394067384544,-0.488315195172048,-0.491236322959881,-0.494157450747494,-0.497078578535120,-0.499999706322855,-0.502920834110474,-0.505841961898114,-0.508763089685835,-0.511684217473489,-0.514605345261191,-0.456437295518040,-0.459341456465261,-0.462245617412140,-0.465149778359418,-0.468053939306467,-0.470958100253475,-0.473862261200605,-0.476766422147756,-0.479670583094816,-0.482574744041903,-0.485478904988948,-0.488383065936044,-0.491287226883124,-0.494191387830340,-0.497095548777341,-0.499999709724474,-0.502903870671577,-0.505808031618661,-0.508712192565739,-0.511616353512845,-0.453801472014040,-0.456688862079795,-0.459576252145611,-0.462463642211528,-0.465351032277353,-0.468238422343134,-0.471125812409023,-0.474013202474809,-0.476900592540657,-0.479787982606435,-0.482675372672325,-0.485562762738251,-0.488450152804023,-0.491337542869858,-0.494224932935645,-0.497112323001486,-0.499999713067374,-0.502887103133156,-0.505774493199059,-0.508661883264814,-0.451195916287720,-0.454066728056336,-0.456937539824813,-0.459808351593354,-0.462679163361767,-0.465549975130435,-0.468420786898887,-0.471291598667576,-0.474162410435972,-0.477033222204539,-0.479904033973063,-0.482774845741602,-0.485645657510181,-0.488516469278717,-0.491387281047164,-0.494258092815738,-0.497128904584292,-0.499999716352916,-0.502870528121357,-0.505741339889924,-0.448620109958102,-0.451474532715010,-0.454328955471903,-0.457183378228738,-0.460037800985720,-0.462892223742643,-0.465746646499434,-0.468601069256336,-0.471455492013234,-0.474309914770154,-0.477164337527002,-0.480018760283829,-0.482873183040849,-0.485727605797722,-0.488582028554629,-0.491436451311553,-0.494290874068252,-0.497145296825285,-0.499999719582113,-0.502854142339007,-0.446073546413956,-0.448911766221464,-0.451749986028977,-0.454588205836450,-0.457426425643998,-0.460264645451562,-0.463102865259035,-0.465941085066509,-0.468779304874042,-0.471617524681579,-0.474455744489059,-0.477293964296610,-0.480132184104064,-0.482970403911627,-0.485808623719084,-0.488646843526511,-0.491485063334191,-0.494323283141724,-0.497161502949135,-0.499999722756703];
% b_n=[-0.499999651672604,-0.496838435898456,-0.493716942125891,-0.490634426344348,-0.487590163008957,-0.484583444470960,-0.481613580429446,-0.478679897402962,-0.475781738220370,-0.472918461530030,-0.470089441326704,-0.467294066495068,-0.464531740369898,-0.461801880311383,-0.459103917295489,-0.456437295518032,-0.453801472014020,-0.451195916287754,-0.448620109958171,-0.446073546414009,-0.503180985617496,-0.499999656063251,-0.496858301248641,-0.493756172429250,-0.490692539443794,-0.487666690140973,-0.484677929827719,-0.481725580737440,-0.478808981517635,-0.475927486735944,-0.473080466404112,-0.470267305518277,-0.467487403617253,-0.464740174353717,-0.462025045083124,-0.459341456465113,-0.456688862079821,-0.454066728056232,-0.451474532714985,-0.448911766221439,-0.506362319562396,-0.503160876228047,-0.499999660371401,-0.496877918514165,-0.493794915878643,-0.490749935810998,-0.487742279226008,-0.484771264071932,-0.481836224814910,-0.478936511941870,-0.476071491481483,-0.473240544541567,-0.470443066864489,-0.467678468396002,-0.464946172870812,-0.462245617412228,-0.459576252145668,-0.456937539824939,-0.454328955471817,-0.451749986029045,-0.509543653507288,-0.506322096392801,-0.503141019494128,-0.499999664599063,-0.496897292313471,-0.493833181481004,-0.490806628624275,-0.487816947406404,-0.484863468112166,-0.481945537147778,-0.479062516558801,-0.476213783564864,-0.473398730111811,-0.470616762438188,-0.467867300658441,-0.465149778359458,-0.462463642211464,-0.459808351593334,-0.457183378228788,-0.454588205836546,-0.512724987452191,-0.509483316557590,-0.506282378616878,-0.503121410683991,-0.499999668748315,-0.496916427151025,-0.493870978022558,-0.490862630740892,-0.487890711409435,-0.484954562353699,-0.482053541636158,-0.479187022588243,-0.476354393359189,-0.473555056480530,-0.470788428446190,-0.468053939306455,-0.465351032277304,-0.462679163361858,-0.460037800985588,-0.457426425644001,-0.515906321397094,-0.512644536722376,-0.509423737739641,-0.506243156768885,-0.503102045183173,-0.499999672821045,-0.496935327420841,-0.493908314075381,-0.490917954706707,-0.487963587559620,-0.485044566713492,-0.482160261611478,-0.479310056606526,-0.476493350522818,-0.473709556233845,-0.470958100253557,-0.468238422343072,-0.465549975130368,-0.462892223742648,-0.460264645451540,-0.519087655341985,-0.515805756887160,-0.512565096862388,-0.509364902853784,-0.506204421618010,-0.503082918491060,-0.499999676819119,-0.496953997409863,-0.493945198003972,-0.490972612765537,-0.488035591790882,-0.485133500634784,-0.482265719853808,-0.479431644565087,-0.476630684021442,-0.473862261200613,-0.471125812408949,-0.468420786898914,-0.465746646499427,-0.463102865258986,-0.522268989286865,-0.518966977051936,-0.515706455985155,-0.512486648938704,-0.509306798052847,-0.506166164161089,-0.503064026217406,-0.499999680744338,-0.496972441301231,-0.493981637971447,-0.491026616868204,-0.488106739658163,-0.485221383101182,-0.482369938607365,-0.479551811809189,-0.476766422147767,-0.474013202474876,-0.471291598667538,-0.468601069256287,-0.465941085066567,-0.525450323231764,-0.522128197216740,-0.518847815107911,-0.515608395023611,-0.512409174487680,-0.509249409831108,-0.506128375615687,-0.503045364078827,-0.499999684598508,-0.496990663177374,-0.494017641945631,-0.491079978681383,-0.488177046348428,-0.485308232649610,-0.482472939596853,-0.479670583094845,-0.476900592540697,-0.474162410436126,-0.471455492013179,-0.468779304874067,-0.528631657176663,-0.525289417381530,-0.521989174230666,-0.518730141108528,-0.515511550922525,-0.512332655501129,-0.509192725013973,-0.506091047413315,-0.503026927895793,-0.499999688383297,-0.497008667023029,-0.494053217704707,-0.491132709595835,-0.488246526691874,-0.485394067384434,-0.482574744041921,-0.479787982606537,-0.477033222204501,-0.474309914770103,-0.471617524681529,-0.531812991121524,-0.528450637546338,-0.525130533353440,-0.521851887193418,-0.518613927357384,-0.515415901171099,-0.512257074412208,-0.509136730747749,-0.506054171193098,-0.503008713589188,-0.499999692100286,-0.497026456727990,-0.494088372843033,-0.491184820734217,-0.488315195172184,-0.485478904989007,-0.482675372672349,-0.479904033973131,-0.477164337527098,-0.474455744489072,-0.534994325066394,-0.531611857711105,-0.528271892476166,-0.524973633278335,-0.521716303792223,-0.518499146841096,-0.515321423810493,-0.512182414082279,-0.509081414490299,-0.506017738795077,-0.502990717177809,-0.499999695751249,-0.497044036090376,-0.494123114776595,-0.491236322959794,-0.488383065936017,-0.485562762738245,-0.482774845741577,-0.480018760283894,-0.477293964296549,-0.538175659011377,-0.534773077875828,-0.531413251598898,-0.528095379363288,-0.524818680227050,-0.521582392511327,-0.518385773208664,-0.515228097416781,-0.512108657787531,-0.509026764000983,-0.505981742255138,-0.502972934774570,-0.499999699337671,-0.497061408818858,-0.494157450747507,-0.491287226883196,-0.488450152804040,-0.485645657510193,-0.482873183040930,-0.480132184104077,-0.541356992956292,-0.537934298040610,-0.534554610721692,-0.531217125448180,-0.527921056661859,-0.524665638181188,-0.521450122607112,-0.518273780751240,-0.515135901084831,-0.512035789207022,-0.508972767332469,-0.505946173797966,-0.502955362585035,-0.499999702861104,-0.497078578535198,-0.494191387830392,-0.491337542869853,-0.488516469278687,-0.485727605797743,-0.482970403911646,-0.544538326901094,-0.541095518205388,-0.537695969844347,-0.534338871533085,-0.531023433096762,-0.527748883851191,-0.524514472005356,-0.521319464085729,-0.518163144382224,-0.515044814413016,-0.511963792409791,-0.508919412821217,-0.505911025832259,-0.502937996903357,-0.499999706322846,-0.497095548777398,-0.494224932935613,-0.491387281047160,-0.488582028554548,-0.485808623719060,-0.547719660845938,-0.544256738370179,-0.540837328967113,-0.537460617618023,-0.534125809531497,-0.530832129521260,-0.527578821403635,-0.524365147420268,-0.521190387679305,-0.518053839618799,-0.514954817487293,-0.511892651844634,-0.508866689079622,-0.505876290945585,-0.502920834110538,-0.499999709724466,-0.497112323001446,-0.494258092815734,-0.491436451311492,-0.488646843526605,-0.550900994790980,-0.547417958534988,-0.543978688089902,-0.540582363702871,-0.537228185966438,-0.533915375191328,-0.530643170802005,-0.527410830754760,-0.524217630976588,-0.521062864824720,-0.517945842564557,-0.514865890867832,-0.511822352326974,-0.508814584987963,-0.505841961898213,-0.502903870671637,-0.499999713067398,-0.497128904584187,-0.494290874068443,-0.491485063334066,-0.554082328735784,-0.550579178699735,-0.547120047212724,-0.543704109787777,-0.540330562401290,-0.536998620861236,-0.533707520200161,-0.530456514089125,-0.527244874273931,-0.524071890030716,-0.520936867641979,-0.517839129891076,-0.514778015574267,-0.511752879030215,-0.508763089685827,-0.505808031618656,-0.502887103133265,-0.499999716352847,-0.497145296825242,-0.494323283141689,-0.557263662680706,-0.553740398864573,-0.550261406335402,-0.546825855872666,-0.543432938836006,-0.540081866531334,-0.536771869598537,-0.533502197423636,-0.530272117571199,-0.527080915236480,-0.523927892719435,-0.520812368914457,-0.517733678821604,-0.514691173072488,-0.511684217473535,-0.508712192565787,-0.505774493198969,-0.502870528121366,-0.499999719582110,-0.497161502949147,-0.560444996625525,-0.556901619029349,-0.553402765458225,-0.549947601957592,-0.546535315270900,-0.543165112201273,-0.539836218996882,-0.536547880758149,-0.533299360868470,-0.530089940442434,-0.526918917796686,-0.523785607937672,-0.520689342068850,-0.517629467114834,-0.514605345261252,-0.511616353512825,-0.508661883264947,-0.505741339889901,-0.502854142339065,-0.499999722756651];
% c_n=[2.48049816579825e-06,2.48054829683710e-06,2.48069667390498e-06,2.48094175061775e-06,2.48128171844157e-06,2.48171493162977e-06,2.48223949440879e-06,2.48285375433515e-06,2.48355616241259e-06,2.48434503113918e-06,2.48521905711941e-06,2.48617647763643e-06,2.48721574403180e-06,2.48833554379198e-06,2.48953458608641e-06,2.49081123186815e-06,2.49216452028560e-06,2.49359267600744e-06,2.49509478101683e-06,2.49666923750044e-06,2.48054813876408e-06,2.48049822424045e-06,2.48054741155173e-06,2.48069419453945e-06,2.48093615212429e-06,2.48127196982407e-06,2.48169974381541e-06,2.48221785402688e-06,2.48282460530326e-06,2.48351857726019e-06,2.48429798857449e-06,2.48516129513354e-06,2.48610711774808e-06,2.48713400502793e-06,2.48824053757969e-06,2.48942524282113e-06,2.49068701941713e-06,2.49202408128073e-06,2.49343561725832e-06,2.49492003030030e-06,2.48069658122185e-06,2.48054759229448e-06,2.48049832682013e-06,2.48054694469689e-06,2.48069171128808e-06,2.48093077993114e-06,2.48126245611518e-06,2.48168498518105e-06,2.48219674281181e-06,2.48279611759817e-06,2.48348170013452e-06,2.48425161111695e-06,2.48510460832491e-06,2.48603917629991e-06,2.48705385994006e-06,2.48814723159218e-06,2.48931803894049e-06,2.49056500208736e-06,2.49188638438061e-06,2.49328143502352e-06,2.48094149816500e-06,2.48069392022376e-06,2.48054675759089e-06,2.48049809815288e-06,2.48054637065599e-06,2.48068939161550e-06,2.48092558663926e-06,2.48125309895781e-06,2.48167050927625e-06,2.48217613748786e-06,2.48276820942703e-06,2.48344536504578e-06,2.48420613054647e-06,2.48504898414865e-06,2.48597235708841e-06,2.48697513840166e-06,2.48805558189183e-06,2.48921266927064e-06,2.49044489702172e-06,2.49175107224894e-06,2.48128211335453e-06,2.48093661553714e-06,2.48069207587590e-06,2.48054679309715e-06,2.48049834116149e-06,2.48054579901555e-06,2.48068696695648e-06,2.48092029881050e-06,2.48124396437186e-06,2.48165622537697e-06,2.48215569371655e-06,2.48274073233106e-06,2.48340983120731e-06,2.48416145539323e-06,2.48499432663324e-06,2.48590682901253e-06,2.48689780127922e-06,2.48796550718151e-06,2.48910911960040e-06,2.49032711699267e-06,2.48171483457889e-06,2.48127198949202e-06,2.48093080217387e-06,2.48068937947937e-06,2.48054577446453e-06,2.48049837748852e-06,2.48054526156755e-06,2.48068470236236e-06,2.48091512476877e-06,2.48123488250703e-06,2.48164213657700e-06,2.48213568384591e-06,2.48271373035872e-06,2.48337484584858e-06,2.48411773630440e-06,2.48494064252355e-06,2.48584241635379e-06,2.48682178374602e-06,2.48787731339009e-06,2.48900763617214e-06,2.48223952166980e-06,2.48169989462073e-06,2.48126254472592e-06,2.48092553191246e-06,2.48068711243957e-06,2.48054534210181e-06,2.48049835840069e-06,2.48054463211555e-06,2.48068237526085e-06,2.48091021544084e-06,2.48122601083358e-06,2.48162841440983e-06,2.48211601553001e-06,2.48268719962989e-06,2.48334055793915e-06,2.48407452619078e-06,2.48488793559351e-06,2.48577917803518e-06,2.48674717690824e-06,2.48779033135019e-06,2.48285376383807e-06,2.48221788557752e-06,2.48168500252228e-06,2.48125316376332e-06,2.48092019403279e-06,2.48068473771879e-06,2.48054463468181e-06,2.48049826677604e-06,2.48054422661565e-06,2.48068033681372e-06,2.48090506405179e-06,2.48121733650563e-06,2.48161491537219e-06,2.48209674258539e-06,2.48266116253419e-06,2.48330678038399e-06,2.48403240119443e-06,2.48483635948651e-06,2.48571712145065e-06,2.48667397549596e-06,2.48355607747064e-06,2.48282460892320e-06,2.48219669368694e-06,2.48167038715261e-06,2.48124382924065e-06,2.48091504909463e-06,2.48068238048853e-06,2.48054410346242e-06,2.48049846771493e-06,2.48054365490385e-06,2.48067815188421e-06,2.48090026359907e-06,2.48120875072640e-06,2.48160164374474e-06,2.48207794462023e-06,2.48263560334340e-06,2.48327375712781e-06,2.48399090728782e-06,2.48478531707015e-06,2.48565615333389e-06,2.48434535181329e-06,2.48351879190346e-06,2.48279642760400e-06,2.48217631667167e-06,2.48165641622148e-06,2.48123514903933e-06,2.48091039171868e-06,2.48068057278818e-06,2.48054393196273e-06,2.48049844926178e-06,2.48054316593915e-06,2.48067591690554e-06,2.48089566398549e-06,2.48120014974768e-06,2.48158865761354e-06,2.48205914300528e-06,2.48261057916335e-06,2.48324118768952e-06,2.48394998167021e-06,2.48473538640625e-06,2.48521896025946e-06,2.48429803364783e-06,2.48348172525515e-06,2.48276807400255e-06,2.48215576559207e-06,2.48164208161746e-06,2.48122595905994e-06,2.48090512083962e-06,2.48067817256306e-06,2.48054305131670e-06,2.48049839759900e-06,2.48054256218298e-06,2.48067393471678e-06,2.48089082032601e-06,2.48119217769536e-06,2.48157584254373e-06,2.48204105276491e-06,2.48258591149589e-06,2.48320939535573e-06,2.48390988300627e-06,2.48617635363352e-06,2.48516137017249e-06,2.48425161807316e-06,2.48344542954856e-06,2.48274071147347e-06,2.48213566616381e-06,2.48162837680588e-06,2.48121710428884e-06,2.48090031643511e-06,2.48067594581933e-06,2.48054263226986e-06,2.48049842911831e-06,2.48054210794652e-06,2.48067195736451e-06,2.48088627554225e-06,2.48118385822395e-06,2.48156344133731e-06,2.48202294926283e-06,2.48256169253528e-06,2.48317786637527e-06,2.48721576103873e-06,2.48610714586994e-06,2.48510456231450e-06,2.48420618942587e-06,2.48340983723036e-06,2.48271392237319e-06,2.48211586310398e-06,2.48161496053616e-06,2.48120872259002e-06,2.48089549843659e-06,2.48067407487250e-06,2.48054207532928e-06,2.48049840345797e-06,2.48054178591189e-06,2.48066985672934e-06,2.48088182863105e-06,2.48117592539070e-06,2.48155100668672e-06,2.48200545504055e-06,2.48253777316865e-06,2.48833564009696e-06,2.48713397231439e-06,2.48603923708710e-06,2.48504903381353e-06,2.48416142204994e-06,2.48337494198125e-06,2.48268722384803e-06,2.48209667808154e-06,2.48160157852260e-06,2.48120031187702e-06,2.48089094668461e-06,2.48067191936410e-06,2.48054152938034e-06,2.48049847435966e-06,2.48054119411627e-06,2.48066803154149e-06,2.48087735209512e-06,2.48116814584656e-06,2.48153885779069e-06,2.48198805174183e-06,2.48953455714813e-06,2.48824053771508e-06,2.48705378346842e-06,2.48597234075433e-06,2.48499433036967e-06,2.48411756494849e-06,2.48334064115154e-06,2.48266112964364e-06,2.48207793655213e-06,2.48158883384802e-06,2.48119186080661e-06,2.48088637137277e-06,2.48066977085674e-06,2.48054108425113e-06,2.48049856631039e-06,2.48054061702513e-06,2.48066579563359e-06,2.48087292422700e-06,2.48116034049573e-06,2.48152679002110e-06,2.49081120304159e-06,2.48942538442690e-06,2.48814706753530e-06,2.48697521435578e-06,2.48590681788247e-06,2.48494062496626e-06,2.48407457030390e-06,2.48330692124562e-06,2.48263555395658e-06,2.48205918291271e-06,2.48157586496252e-06,2.48118398850887e-06,2.48088167862299e-06,2.48066789916087e-06,2.48054062373061e-06,2.48049855009195e-06,2.48054010668505e-06,2.48066401355392e-06,2.48086870301349e-06,2.48115283436007e-06,2.49216459999192e-06,2.49068695382321e-06,2.48931799032139e-06,2.48805568901169e-06,2.48689782665781e-06,2.48584256517835e-06,2.48488809351735e-06,2.48403234856326e-06,2.48327369305048e-06,2.48261046331409e-06,2.48204089489832e-06,2.48156339955779e-06,2.48117597397751e-06,2.48087744642027e-06,2.48066593426222e-06,2.48054021293909e-06,2.48049865543420e-06,2.48053957803357e-06,2.48066225542560e-06,2.48086437241600e-06,2.49359262353512e-06,2.49202419113117e-06,2.49056489612968e-06,2.48921268000223e-06,2.48796554271104e-06,2.48682179767570e-06,2.48577917199862e-06,2.48483623043001e-06,2.48399074171254e-06,2.48324130115827e-06,2.48258586849536e-06,2.48202293377757e-06,2.48155094061473e-06,2.48116820696416e-06,2.48087292091384e-06,2.48066401137044e-06,2.48053980986129e-06,2.48049875283091e-06,2.48053924147368e-06,2.48066039435788e-06,2.49509467977641e-06,2.49343565341860e-06,2.49188638639897e-06,2.49044484715287e-06,2.48910914216049e-06,2.48787737008998e-06,2.48674721263516e-06,2.48571709111230e-06,2.48478534135856e-06,2.48394989827788e-06,2.48320936433453e-06,2.48256157743867e-06,2.48200536283710e-06,2.48153884120004e-06,2.48116047977010e-06,2.48086882183497e-06,2.48066194830845e-06,2.48053929787308e-06,2.48049850171190e-06,2.48053874116053e-06,2.49666918011932e-06,2.49492011003024e-06,2.49328145534023e-06,2.49175104917515e-06,2.49032707885942e-06,2.48900755975932e-06,2.48779054257534e-06,2.48667384191881e-06,2.48565615029157e-06,2.48473535507528e-06,2.48390983650014e-06,2.48317788997760e-06,2.48253769390009e-06,2.48198811673253e-06,2.48152688221393e-06,2.48115270781665e-06,2.48086465509305e-06,2.48066040890644e-06,2.48053879229736e-06,2.48049863076366e-06];
% n_a_n=size(a_n,2);
a_n = [-0.499999386832159,-0.504236669771364,-0.508473952710635,-0.512711235649818,-0.516948518589075,-0.521185801528405,-0.525423084467600,-0.529660367406890,-0.533897650346180,-0.538134933285369,-0.542372216224678,-0.546609499163909,-0.550846782103105,-0.555084065042498,-0.559321347981614,-0.563558630920917,-0.567795913860111,-0.572033196799388,-0.576270479738616,-0.580507762677986,-0.495797721488620,-0.499999397094400,-0.504201072700163,-0.508402748305977,-0.512604423911834,-0.516806099517736,-0.521007775123467,-0.525209450729069,-0.529411126334991,-0.533612801940800,-0.537814477546705,-0.542016153152488,-0.546217828758308,-0.550419504364139,-0.554621179970007,-0.558822855575857,-0.563024531181592,-0.567226206787461,-0.571427882393286,-0.575629557999122,-0.491666083648707,-0.495832745374603,-0.499999407100175,-0.504166068826254,-0.508332730551898,-0.512499392277944,-0.516666054003837,-0.520832715729865,-0.524999377455766,-0.529166039181505,-0.533332700907420,-0.537499362633206,-0.541666024359003,-0.545832686084951,-0.549999347810712,-0.554166009536557,-0.558332671262373,-0.562499332988229,-0.566665994714099,-0.570832656439982,-0.487602737103301,-0.491734963688960,-0.495867190274561,-0.499999416860250,-0.504131643446045,-0.508263870031591,-0.512396096617175,-0.516528323202712,-0.520660549788174,-0.524792776373965,-0.528925002959532,-0.533057229545192,-0.537189456130726,-0.541321682716457,-0.545453909302002,-0.549586135887664,-0.553718362473272,-0.557850589058822,-0.561982815644500,-0.566115042230104,-0.483606002565168,-0.487704358519045,-0.491802714473071,-0.495901070426974,-0.499999426380600,-0.504097782334535,-0.508196138288523,-0.512294494242452,-0.516392850196371,-0.520491206150317,-0.524589562104240,-0.528687918058173,-0.532786274012226,-0.536884629966128,-0.540982985919943,-0.545081341874057,-0.549179697827851,-0.553278053781914,-0.557376409735734,-0.561474765689792,-0.479674255357723,-0.483739291420046,-0.487804327482438,-0.491869363544702,-0.495934399607134,-0.499999435669437,-0.504064471731731,-0.508129507794641,-0.512194543856971,-0.516259579919359,-0.520324615981582,-0.524389652044004,-0.528454688106369,-0.532519724168684,-0.536584760231042,-0.540649796293343,-0.544714832355727,-0.548779868418074,-0.552844904480344,-0.556909940542835,-0.475805923216336,-0.479838176802780,-0.483870430389397,-0.487902683975931,-0.491934937562523,-0.495967191149116,-0.499999444735683,-0.504031698321880,-0.508063951908348,-0.512096205494916,-0.516128459081483,-0.520160712668142,-0.524192966254605,-0.528225219841258,-0.532257473427897,-0.536289727014359,-0.540321980600974,-0.544354234187465,-0.548386487774149,-0.552418741360678,-0.471999484183181,-0.475999479812002,-0.479999475440528,-0.483999471069241,-0.487999466697919,-0.491999462326669,-0.495999457955226,-0.499999453584031,-0.503999449212563,-0.507999444841217,-0.511999440470029,-0.515999436098591,-0.519999431727340,-0.523999427355981,-0.527999422984693,-0.531999418613285,-0.535999414242032,-0.539999409870634,-0.543999405499283,-0.547999401128068,-0.468253464621362,-0.472221714321517,-0.476189964021682,-0.480158213721817,-0.484126463422063,-0.488094713122213,-0.492062962822414,-0.496031212522652,-0.499999462222820,-0.503967711922985,-0.507935961623086,-0.511904211323254,-0.515872461023499,-0.519840710723680,-0.523808960423882,-0.527777210123967,-0.531745459824226,-0.535713709524435,-0.539681959224567,-0.543650208924813,-0.464566437304667,-0.468503441010504,-0.472440444716630,-0.476377448422546,-0.480314452128535,-0.484251455834448,-0.488188459540423,-0.492125463246466,-0.496062466952459,-0.499999470658376,-0.503936474364409,-0.507873478070211,-0.511810481776299,-0.515747485482212,-0.519684489188296,-0.523621492894172,-0.527558496600135,-0.531495500306012,-0.535432504012062,-0.539369507718094,-0.460937019608149,-0.464843265537108,-0.468749511465940,-0.472655757394827,-0.476562003323667,-0.480468249252512,-0.484374495181447,-0.488280741110398,-0.492186987039281,-0.496093232968083,-0.499999478897006,-0.503905724825859,-0.507811970754732,-0.511718216683623,-0.515624462612631,-0.519530708541369,-0.523436954470284,-0.527343200399113,-0.531249446328064,-0.535155692256944,-0.457363871778964,-0.461239836794062,-0.465115801809103,-0.468991766824156,-0.472867731839256,-0.476743696854345,-0.480619661869380,-0.484495626884478,-0.488371591899522,-0.492247556914644,-0.496123521929741,-0.499999486944761,-0.503875451959940,-0.507751416974966,-0.511627381990041,-0.515503347005124,-0.519379312020232,-0.523255277035293,-0.527131242050426,-0.531007207065463,-0.453845695286872,-0.457691845246907,-0.461537995206994,-0.465384145167137,-0.469230295127111,-0.473076445087164,-0.476922595047301,-0.480768745007305,-0.484614894967323,-0.488461044927477,-0.492307194887507,-0.496153344847532,-0.499999494807518,-0.503845644767708,-0.507691794727679,-0.511537944687750,-0.515384094647788,-0.519230244607952,-0.523076394567880,-0.526922544528054,-0.450381231251407,-0.454198021346783,-0.458014811442127,-0.461831601537514,-0.465648391632806,-0.469465181728185,-0.473281971823568,-0.477098761918867,-0.480915552014307,-0.484732342109624,-0.488549132204938,-0.492365922300204,-0.496182712395665,-0.499999502491073,-0.503816292586315,-0.507633082681631,-0.511449872777076,-0.515266662872353,-0.519083452967759,-0.522900243063169,-0.446969258939812,-0.450757134015490,-0.454545009091271,-0.458332884167054,-0.462120759242841,-0.465908634318664,-0.469696509394371,-0.473484384470139,-0.477272259545845,-0.481060134621679,-0.484848009697415,-0.488635884773099,-0.492423759848941,-0.496211634924716,-0.499999510000403,-0.503787385076204,-0.507575260151980,-0.511363135227749,-0.515151010303509,-0.518938885379255,-0.443608594332741,-0.447367989200038,-0.451127384067265,-0.454886778934406,-0.458646173801639,-0.462405568668901,-0.466164963536090,-0.469924358403237,-0.473683753270593,-0.477443148137879,-0.481202543005005,-0.484961937872245,-0.488721332739465,-0.492480727606753,-0.496240122473877,-0.499999517341206,-0.503758912208431,-0.507518307075645,-0.511277701942887,-0.515037096810065,-0.440298088754746,-0.444029428489969,-0.447760768225167,-0.451492107960499,-0.455223447695685,-0.458954787430813,-0.462686127166006,-0.466417466901221,-0.470148806636477,-0.473880146371722,-0.477611486106866,-0.481342825842085,-0.485074165577181,-0.488805505312450,-0.492536845047716,-0.496268184782919,-0.499999524518077,-0.503730864253371,-0.507462203988552,-0.511193543723847,-0.437036627565011,-0.440740327798678,-0.444444028032174,-0.448147728265819,-0.451851428499415,-0.455555128732990,-0.459258828966555,-0.462962529200219,-0.466666229433830,-0.470369929667438,-0.474073629900981,-0.477777330134602,-0.481481030368229,-0.485184730601804,-0.488888430835405,-0.492592131069009,-0.496295831302518,-0.499999531536203,-0.503703231769861,-0.507406932003353,-0.433823128905930,-0.437499596100037,-0.441176063294122,-0.444852530488312,-0.448528997682452,-0.452205464876442,-0.455881932070607,-0.459558399264682,-0.463234866458881,-0.466911333653000,-0.470587800847031,-0.474264268041189,-0.477940735235354,-0.481617202429337,-0.485293669623643,-0.488970136817701,-0.492646604011790,-0.496323071205912,-0.499999538399944,-0.503676005594203,-0.430656542507072,-0.434306174223217,-0.437955805939370,-0.441605437655538,-0.445255069371725,-0.448904701087990,-0.452554332804010,-0.456203964520219,-0.459853596236381,-0.463503227952521,-0.467152859668755,-0.470802491384882,-0.474452123101071,-0.478101754817201,-0.481751386533305,-0.485401018249487,-0.489050649965602,-0.492700281681814,-0.496349913397937,-0.499999545114181];
b_n = [-0.499999386832095,-0.495797721488294,-0.491666083648998,-0.487602737103306,-0.483606002564886,-0.479674255358082,-0.475805923215796,-0.471999484183215,-0.468253464621297,-0.464566437304653,-0.460937019608150,-0.457363871778948,-0.453845695286876,-0.450381231251485,-0.446969258939777,-0.443608594332782,-0.440298088754733,-0.437036627564908,-0.433823128905958,-0.430656542507142,-0.504236669771340,-0.499999397094119,-0.495832745374828,-0.491734963688918,-0.487704358518818,-0.483739291420430,-0.479838176802363,-0.475999479811986,-0.472221714321464,-0.468503441010657,-0.464843265536993,-0.461239836794011,-0.457691845246902,-0.454198021346801,-0.450757134015552,-0.447367989199963,-0.444029428489949,-0.440740327798595,-0.437499596100052,-0.434306174223246,-0.508473952710598,-0.504201072699965,-0.499999407100671,-0.495867190274543,-0.491802714472761,-0.487804327482788,-0.483870430388939,-0.479999475440482,-0.476189964021671,-0.472440444716555,-0.468749511465941,-0.465115801809150,-0.461537995206984,-0.458014811442133,-0.454545009091377,-0.451127384067212,-0.447760768225229,-0.444444028032256,-0.441176063294219,-0.437955805939457,-0.512711235649860,-0.508402748305796,-0.504166068826520,-0.499999416860167,-0.495901070426702,-0.491869363545146,-0.487902683975514,-0.483999471069266,-0.480158213721872,-0.476377448422527,-0.472655757394753,-0.468991766824154,-0.465384145167143,-0.461831601537436,-0.458332884167022,-0.454886778934469,-0.451492107960441,-0.448147728265730,-0.444852530488269,-0.441605437655572,-0.516948518589123,-0.512604423911635,-0.508332730552353,-0.504131643445781,-0.499999426380647,-0.495934399607509,-0.491934937562096,-0.487999466697876,-0.484126463421995,-0.480314452128463,-0.476562003323713,-0.472867731839265,-0.469230295127127,-0.465648391632911,-0.462120759242830,-0.458646173801609,-0.455223447695617,-0.451851428499328,-0.448528997682404,-0.445255069371653,-0.521185801528355,-0.516806099517446,-0.512499392278196,-0.508263870031395,-0.504097782334568,-0.499999435669848,-0.495967191148658,-0.491999462326606,-0.488094713122261,-0.484251455834414,-0.480468249252546,-0.476743696854359,-0.473076445087307,-0.469465181728188,-0.465908634318600,-0.462405568668883,-0.458954787430914,-0.455555128733015,-0.452205464876548,-0.448904701087902,-0.525423084467619,-0.521007775123284,-0.516666054004030,-0.512396096617012,-0.508196138288516,-0.504064471732200,-0.499999444735249,-0.495999457955311,-0.492062962822500,-0.488188459540450,-0.484374495181499,-0.480619661869432,-0.476922595047208,-0.473281971823594,-0.469696509394437,-0.466164963536139,-0.462686127166061,-0.459258828966541,-0.455881932070697,-0.452554332804107,-0.529660367406908,-0.525209450729060,-0.520832715729849,-0.516528323202683,-0.512294494242503,-0.508129507794603,-0.504031698321833,-0.499999453583874,-0.496031212522550,-0.492125463246330,-0.488280741110390,-0.484495626884418,-0.480768745007302,-0.477098761918839,-0.473484384470053,-0.469924358403310,-0.466417466901205,-0.462962529200202,-0.459558399264808,-0.456203964520149,-0.533897650346197,-0.529411126334856,-0.524999377455691,-0.520660549788309,-0.516392850196377,-0.512194543856894,-0.508063951908398,-0.503999449212618,-0.499999462222762,-0.496062466952453,-0.492186987039225,-0.488371591899598,-0.484614894967439,-0.480915552014248,-0.477272259545823,-0.473683753270614,-0.470148806636525,-0.466666229433822,-0.463234866458839,-0.459853596236408,-0.538134933285500,-0.533612801940769,-0.529166039181566,-0.524792776373853,-0.520491206150331,-0.516259579919276,-0.512096205494906,-0.507999444841282,-0.503967711923001,-0.499999470658354,-0.496093232968061,-0.492247556914653,-0.488461044927402,-0.484732342109573,-0.481060134621597,-0.477443148137798,-0.473880146371722,-0.470369929667429,-0.466911333653043,-0.463503227952488,-0.542372216224602,-0.537814477546549,-0.533332700907429,-0.528925002959475,-0.524589562104285,-0.520324615981598,-0.516128459081666,-0.511999440470051,-0.507935961623127,-0.503936474364210,-0.499999478897012,-0.496123521929737,-0.492307194887489,-0.488549132204891,-0.484848009697407,-0.481202543005157,-0.477611486106851,-0.474073629900991,-0.470587800847110,-0.467152859668708,-0.546609499163828,-0.542016153152509,-0.537499362633257,-0.533057229545079,-0.528687918058191,-0.524389652043957,-0.520160712668104,-0.515999436098678,-0.511904211323263,-0.507873478070378,-0.503905724825862,-0.499999486944745,-0.496153344847517,-0.492365922300273,-0.488635884773211,-0.484961937872323,-0.481342825842106,-0.477777330134667,-0.474264268041178,-0.470802491384811,-0.550846782103179,-0.546217828758406,-0.541666024359083,-0.537189456130739,-0.532786274012217,-0.528454688106415,-0.524192966254639,-0.519999431727287,-0.515872461023612,-0.511810481776253,-0.507811970754790,-0.503875451959825,-0.499999494807603,-0.496182712395616,-0.492423759848904,-0.488721332739380,-0.485074165577280,-0.481481030368286,-0.477940735235241,-0.474452123100965,-0.555084065042331,-0.550419504364128,-0.545832686084946,-0.541321682716305,-0.536884629966101,-0.532519724168784,-0.528225219841239,-0.523999427355913,-0.519840710723663,-0.515747485482202,-0.511718216683644,-0.507751416974979,-0.503845644767597,-0.499999502490989,-0.496211634924724,-0.492480727606731,-0.488805505312547,-0.485184730601804,-0.481617202429443,-0.478101754817221,-0.559321347981670,-0.554621179970044,-0.549999347810746,-0.545453909302012,-0.540982985920027,-0.536584760231055,-0.532257473427829,-0.527999422984564,-0.523808960423880,-0.519684489188233,-0.515624462612518,-0.511627381990026,-0.507691794727714,-0.503816292586392,-0.499999510000451,-0.496240122473887,-0.492536845047819,-0.488888430835396,-0.485293669623630,-0.481751386533366,-0.563558630920968,-0.558822855575770,-0.554166009536554,-0.549586135887551,-0.545081341873975,-0.540649796293414,-0.536289727014368,-0.531999418613338,-0.527777210124037,-0.523621492894128,-0.519530708541464,-0.515503347005116,-0.511537944687767,-0.507633082681708,-0.503787385076160,-0.499999517341167,-0.496268184782908,-0.492592131069017,-0.488970136817753,-0.485401018249545,-0.567795913860227,-0.563024531181621,-0.558332671262454,-0.553718362473247,-0.549179697827926,-0.544714832355737,-0.540321980600969,-0.535999414242019,-0.531745459824345,-0.527558496600210,-0.523436954470308,-0.519379312020138,-0.515384094647877,-0.511449872777007,-0.507575260151978,-0.503758912208303,-0.499999524518148,-0.496295831302633,-0.492646604011853,-0.489050649965600,-0.572033196799439,-0.567226206787540,-0.562499332988257,-0.557850589058870,-0.553278053781768,-0.548779868418185,-0.544354234187540,-0.539999409870579,-0.535713709524423,-0.531495500306084,-0.527343200399270,-0.523255277035256,-0.519230244607872,-0.515266662872307,-0.511363135227742,-0.507518307075699,-0.503730864253401,-0.499999531536116,-0.496323071205981,-0.492700281681820,-0.576270479738625,-0.571427882393345,-0.566665994714103,-0.561982815644496,-0.557376409735800,-0.552844904480507,-0.548386487774057,-0.543999405499348,-0.539681959224659,-0.535432504012041,-0.531249446328044,-0.527131242050331,-0.523076394568007,-0.519083452967681,-0.515151010303540,-0.511277701942868,-0.507462203988551,-0.503703231769881,-0.499999538400100,-0.496349913397972,-0.580507762677966,-0.575629557999017,-0.570832656439944,-0.566115042230114,-0.561474765689770,-0.556909940542748,-0.552418741360750,-0.547999401127963,-0.543650208924879,-0.539369507718052,-0.535155692257010,-0.531007207065465,-0.526922544527961,-0.522900243063099,-0.518938885379239,-0.515037096810041,-0.511193543723771,-0.507406932003450,-0.503676005594164,-0.499999545114165];
c_n = [4.37382803179007e-06,4.37398377494911e-06,4.37444586109370e-06,4.37520657803159e-06,4.37625869320367e-06,4.37759512356327e-06,4.37920879124338e-06,4.38109324292554e-06,4.38324196195706e-06,4.38564870261194e-06,4.38830738552159e-06,4.39121219172325e-06,4.39435739309213e-06,4.39773776222545e-06,4.40134732893408e-06,4.40518160467760e-06,4.40923504401703e-06,4.41350310204576e-06,4.41798106613216e-06,4.42266427079805e-06,4.37398404639165e-06,4.37382830584151e-06,4.37398142872370e-06,4.37443583774982e-06,4.37518408860503e-06,4.37621903898959e-06,4.37753354274149e-06,4.37912103094781e-06,4.38097509428776e-06,4.38308951355178e-06,4.38545786799013e-06,4.38807449551109e-06,4.39093356903040e-06,4.39402965313856e-06,4.39735722063870e-06,4.40091109480910e-06,4.40468610826698e-06,4.40867763905883e-06,4.41288064193721e-06,4.41729058930067e-06,4.37444555730005e-06,4.37398104259058e-06,4.37382768424702e-06,4.37397857293926e-06,4.37442533320038e-06,4.37516152874182e-06,4.37617964549195e-06,4.37747310329894e-06,4.37903534927153e-06,4.38085978619111e-06,4.38294061645497e-06,4.38527164980381e-06,4.38784710498109e-06,4.39066168470857e-06,4.39370962532879e-06,4.39698573075667e-06,4.40048501385103e-06,4.40420248152603e-06,4.40813324989243e-06,4.41227271894993e-06,4.37520660753850e-06,4.37443571315237e-06,4.37397883430953e-06,4.37382833097384e-06,4.37397667524871e-06,4.37441626067013e-06,4.37514029415718e-06,4.37614190523540e-06,4.37741438723191e-06,4.37895177864410e-06,4.38074726955319e-06,4.38279532822254e-06,4.38508990656719e-06,4.38762529880332e-06,4.39039607922732e-06,4.39339720054507e-06,4.39662313794378e-06,4.40006886868493e-06,4.40373000280927e-06,4.40760145341949e-06,4.37625900471831e-06,4.37518412795553e-06,4.37442605024757e-06,4.37397668870439e-06,4.37382829467888e-06,4.37397406640027e-06,4.37440665080494e-06,4.37511902669765e-06,4.37610464587309e-06,4.37735709476549e-06,4.37887006518160e-06,4.38063744987013e-06,4.38265354874913e-06,4.38491245859159e-06,4.38740849552413e-06,4.39013687964472e-06,4.39309189906111e-06,4.39626881317522e-06,4.39966254670409e-06,4.40326848889711e-06,4.37759472859146e-06,4.37621840334570e-06,4.37516142122168e-06,4.37441564716532e-06,4.37397373247842e-06,4.37382798692934e-06,4.37397134945863e-06,4.37439751734990e-06,4.37509857061955e-06,4.37606853748310e-06,4.37730109675528e-06,4.37879044366168e-06,4.38053041302261e-06,4.38251495328307e-06,4.38473899845924e-06,4.38719690269046e-06,4.38988368882297e-06,4.39279385101348e-06,4.39592269586494e-06,4.39926562353315e-06,4.37920933734477e-06,4.37753378666778e-06,4.37618027271260e-06,4.37514054960677e-06,4.37440706190269e-06,4.37397225267496e-06,4.37382891821625e-06,4.37396972050147e-06,4.37438848374280e-06,4.37507837080080e-06,4.37603314591762e-06,4.37724660640368e-06,4.37871250025329e-06,4.38042558780711e-06,4.38237986484254e-06,4.38456970886715e-06,4.38699030763340e-06,4.38963610567117e-06,4.39250277068572e-06,4.39558477952643e-06,4.38109322492525e-06,4.37912103890283e-06,4.37747313435092e-06,4.37614185334309e-06,4.37511911918686e-06,4.37439754350776e-06,4.37396958963380e-06,4.37382859772046e-06,4.37396735870265e-06,4.37437951824171e-06,4.37505892337422e-06,4.37599855192840e-06,4.37719327171730e-06,4.37863659079733e-06,4.38032323669431e-06,4.38224755267650e-06,4.38440437529722e-06,4.38678835038165e-06,4.38939460200378e-06,4.39221816932863e-06,4.38324204506055e-06,4.38097502551677e-06,4.37903529149894e-06,4.37741445902087e-06,4.37610471984938e-06,4.37509844678844e-06,4.37438844638882e-06,4.37396751756329e-06,4.37382866367047e-06,4.37396543158216e-06,4.37437102815563e-06,4.37503961823758e-06,4.37596504243467e-06,4.37714110470918e-06,4.37856235698362e-06,4.38022331337933e-06,4.38211861963745e-06,4.38424284510077e-06,4.38659098174049e-06,4.38915849555818e-06,4.38564883310851e-06,4.38308932731303e-06,4.38085991934951e-06,4.37895169236095e-06,4.37735718249223e-06,4.37606849094006e-06,4.37507833366019e-06,4.37437972395147e-06,4.37396545420933e-06,4.37382872211676e-06,4.37396328955086e-06,4.37436263892578e-06,4.37502096494796e-06,4.37593196265679e-06,4.37709021991490e-06,4.37848987936965e-06,4.38012575800878e-06,4.38199232212317e-06,4.38408490894788e-06,4.38639818076349e-06,4.38830731676004e-06,4.38545784645516e-06,4.38294062180355e-06,4.38074729203771e-06,4.37887005889718e-06,4.37730107625413e-06,4.37603327161308e-06,4.37505895354123e-06,4.37437112829613e-06,4.37396311015581e-06,4.37382878910741e-06,4.37396124428801e-06,4.37435452623626e-06,4.37500258188589e-06,4.37589994555685e-06,4.37704055013323e-06,4.37841898826648e-06,4.38003022196686e-06,4.38186914263604e-06,4.38393057373055e-06,4.39121213673115e-06,4.38807456825188e-06,4.38527164632450e-06,4.38279522468025e-06,4.38063745701320e-06,4.37879038265238e-06,4.37724651294807e-06,4.37599870311077e-06,4.37503954797240e-06,4.37436280218171e-06,4.37396125265108e-06,4.37382875474053e-06,4.37395934736117e-06,4.37434654723825e-06,4.37498488009295e-06,4.37586851373640e-06,4.37699192511870e-06,4.37834989833067e-06,4.37993710539570e-06,4.38174867003359e-06,4.39435745649283e-06,4.39093366412179e-06,4.38784718944384e-06,4.38508991209825e-06,4.38265352255545e-06,4.38053030297932e-06,4.37871263344280e-06,4.37719322003112e-06,4.37596503163578e-06,4.37502099926745e-06,4.37435460755939e-06,4.37395924093726e-06,4.37382885809723e-06,4.37395739349386e-06,4.37433869019198e-06,4.37496724124514e-06,4.37583763149070e-06,4.37694449798246e-06,4.37828189989743e-06,4.37984590752862e-06,4.39773752728013e-06,4.39402962441265e-06,4.39066167408586e-06,4.38762524074939e-06,4.38491231846173e-06,4.38251504704440e-06,4.38042554239677e-06,4.37863655456121e-06,4.37714115201922e-06,4.37593200890422e-06,4.37500265562230e-06,4.37434648483370e-06,4.37395732690167e-06,4.37382904528056e-06,4.37395547439398e-06,4.37433106560859e-06,4.37495038140501e-06,4.37580758660718e-06,4.37689785656075e-06,4.37821602767365e-06,4.40134741771692e-06,4.39735718479209e-06,4.39370953812911e-06,4.39039612555373e-06,4.38740858707210e-06,4.38473908214983e-06,4.38237972400680e-06,4.38032320401620e-06,4.37856238091956e-06,4.37709024654561e-06,4.37589983526072e-06,4.37498473840653e-06,4.37433876985673e-06,4.37395554976851e-06,4.37382898248452e-06,4.37395357529444e-06,4.37432377964537e-06,4.37493363165739e-06,4.37577835174858e-06,4.37685249821633e-06,4.40518160421514e-06,4.40091110078572e-06,4.39698578781863e-06,4.39339702229462e-06,4.39013683608713e-06,4.38719699203124e-06,4.38456966280321e-06,4.38224752268998e-06,4.38022336156253e-06,4.37848992506590e-06,4.37704047604905e-06,4.37586841786684e-06,4.37496735527460e-06,4.37433117437665e-06,4.37395351587916e-06,4.37382916485861e-06,4.37395187406943e-06,4.37431640509076e-06,4.37491744712829e-06,4.37574962855711e-06,4.40923516202733e-06,4.40468615798642e-06,4.40048501746924e-06,4.39662318178872e-06,4.39309204847470e-06,4.38988358137882e-06,4.38699024100824e-06,4.38440438201141e-06,4.38211868609998e-06,4.38012583529888e-06,4.37841903211412e-06,4.37699180041741e-06,4.37583761317187e-06,4.37495019396193e-06,4.37432365835129e-06,4.37395174065910e-06,4.37382911334274e-06,4.37395014061380e-06,4.37430926942280e-06,4.37490141553097e-06,4.41350326687428e-06,4.40867780861481e-06,4.40420241182565e-06,4.40006901846309e-06,4.39626877521398e-06,4.39279392859434e-06,4.38963619617866e-06,4.38678831396638e-06,4.38424284294904e-06,4.38199240678021e-06,4.38003037464968e-06,4.37834978287400e-06,4.37694434667866e-06,4.37580753443236e-06,4.37493363447973e-06,4.37431645736145e-06,4.37395004014446e-06,4.37382909863352e-06,4.37394847444036e-06,4.37430218749115e-06,4.41798103947994e-06,4.41288067627488e-06,4.40813313815718e-06,4.40373005137803e-06,4.39966266676938e-06,4.39592272832943e-06,4.39250257302808e-06,4.38939451871720e-06,4.38659112634633e-06,4.38408483732048e-06,4.38186902745756e-06,4.37993701579593e-06,4.37828217005847e-06,4.37689764623447e-06,4.37577840146850e-06,4.37491736332518e-06,4.37430919686738e-06,4.37394841686751e-06,4.37382920987444e-06,4.37394671972283e-06,4.42266416925905e-06,4.41729045864483e-06,4.41227257995348e-06,4.40760142247890e-06,4.40326855550622e-06,4.39926564360869e-06,4.39558473260780e-06,4.39221814905234e-06,4.38915852965690e-06,4.38639817595855e-06,4.38393070004808e-06,4.38174875771946e-06,4.37984593450197e-06,4.37821592823415e-06,4.37685240623439e-06,4.37574953156577e-06,4.37490133087998e-06,4.37430229593265e-06,4.37394663060413e-06,4.37382942631640e-06];
n_a_n=size(a_n,2);
d_n=[-0.493750000000005,-0.481249999999997,-0.468750000000001,-0.456249999999999,-0.443750000000000,-0.431250000000003,-0.418749999999997,-0.406250000000002,-0.393750000000003,-0.381250000000002,-0.368750000000002,-0.356250000000004,-0.343750000000000,-0.331249999999999,-0.318749999999998,-0.306250000000001,-0.293750000000000,-0.281250000000000,-0.268749999999999,-0.256249999999997,-0.243749999999999,-0.231250000000000,-0.218750000000000,-0.206249999999998,-0.193750000000000,-0.181250000000000,-0.168750000000001,-0.156250000000000,-0.143750000000000,-0.131250000000000,-0.118750000000000,-0.106250000000000,-0.0937500000000001,-0.0812500000000001,-0.0687500000000000,-0.0562500000000000,-0.0437500000000000,-0.0312500000000000,-0.0187500000000000,-0.00625000000000000,0.00624999999999996,0.0187500000000000,0.0312500000000000,0.0437500000000001,0.0562500000000000,0.0687499999999999,0.0812500000000001,0.0937499999999998,0.106250000000000,0.118750000000000,0.131250000000000,0.143750000000000,0.156250000000000,0.168750000000000,0.181250000000000,0.193749999999999,0.206249999999999,0.218750000000000,0.231250000000001,0.243750000000000,0.256250000000001,0.268749999999998,0.281250000000002,0.293749999999999,0.306250000000001,0.318749999999998,0.331250000000003,0.343749999999999,0.356250000000004,0.368750000000001,0.381250000000003,0.393749999999999,0.406250000000002,0.418750000000006,0.431249999999997,0.443750000000001,0.456249999999993,0.468750000000002,0.481249999999988,0.493750000000004];
e_n=[-0.121888010416669,-0.115794260416665,-0.109856760416667,-0.104075510416666,-0.0984505104166666,-0.0929817604166678,-0.0876692604166654,-0.0825130104166674,-0.0775130104166677,-0.0726692604166674,-0.0679817604166673,-0.0634505104166680,-0.0590755104166668,-0.0548567604166664,-0.0507942604166661,-0.0468880104166670,-0.0431380104166666,-0.0395442604166668,-0.0361067604166664,-0.0328255104166659,-0.0297005104166664,-0.0267317604166666,-0.0239192604166666,-0.0212630104166662,-0.0187630104166666,-0.0164192604166667,-0.0142317604166668,-0.0122005104166666,-0.0103255104166667,-0.00860676041666670,-0.00704426041666668,-0.00563801041666668,-0.00438801041666668,-0.00329426041666667,-0.00235676041666667,-0.00157551041666667,-0.000950510416666666,-0.000481760416666668,-0.000169260416666667,-1.30104166666667e-05,-1.30104166666664e-05,-0.000169260416666667,-0.000481760416666666,-0.000950510416666670,-0.00157551041666667,-0.00235676041666666,-0.00329426041666667,-0.00438801041666665,-0.00563801041666668,-0.00704426041666669,-0.00860676041666669,-0.0103255104166667,-0.0122005104166667,-0.0142317604166667,-0.0164192604166667,-0.0187630104166665,-0.0212630104166665,-0.0239192604166667,-0.0267317604166668,-0.0297005104166667,-0.0328255104166670,-0.0361067604166660,-0.0395442604166674,-0.0431380104166664,-0.0468880104166669,-0.0507942604166660,-0.0548567604166678,-0.0590755104166665,-0.0634505104166680,-0.0679817604166672,-0.0726692604166677,-0.0775130104166661,-0.0825130104166675,-0.0876692604166691,-0.0929817604166654,-0.0984505104166672,-0.104075510416663,-0.109856760416667,-0.115794260416661,-0.121888010416668];
n_d_n=size(d_n,2);
%形成发电机的功角+极限约束
alpha_g=[-ones(ng,1),ones(ng,1),zeros(ng,1),zeros(ng,1)];%输入参数
beta_g=[zeros(ng,1),zeros(ng,1),-ones(ng,1),ones(ng,1)];
gamma_g=[Pmin,-Pmax,Qmin,-Qmax];
% 形成对应于Gbus，Bbus的导纳向量
II=sub2ind([nbus,nbus],unibranch(:,1),unibranch(:,2));
Gbranch=Gbus(II);
Bbranch=Bbus(II);

%% ---- 模型构建 ------------------------------------------------------------
con=[];
for t=1:nt
    %节点有功平衡
    con=con+[(-Vgen_bus*P(:,t)+Pload(:,t)+baseMVA*(diag(Gbus).*V_2(:,t)+Bbus_*theta(:,t)+...
        (-1)*VFTunibranch_bus_sum*(Gbranch.*theta_xi(:,t)))==0):['lamda_p_',num2str(t)]];
    %节点无功平衡
    con=con+[(-Vgen_bus*Q(:,t)+Qload(:,t)+baseMVA*(-diag(Bbus).*V_2(:,t)-Gbus_*theta(:,t)+...
        VFTunibranch_bus_sum*(Bbranch.*theta_xi(:,t)))==0):['lamda_q_',num2str(t)]];
    %松弛约束;
    for n=1:n_a_n
        con=con+[(-theta_vi(:,t)+a_n(n)*V_2(unibranch(:,1),t)+b_n(n)*V_2(unibranch(:,2),t)+c_n(n)*ones(nunibranch,1)<=0):['tau_',num2str(n),'_',num2str(t)]];
    end
    for n=1:n_d_n
        con=con+[-theta_ti(:,t)+d_n(n)*VFTunibus_branch_diff*theta(:,t)+e_n(n)*ones(nunibranch,1)<=0];
    end
    con=con+[theta_xi(:,t)==theta_vi(:,t)+theta_ti(:,t)];
    %发电机出力范围约束
    for a=1:size(alpha_g,2)
        con=con+[(alpha_g(:,a).*P(:,t)+beta_g(:,a).*Q(:,t)+gamma_g(:,a)<=0):['pi_gen_',num2str(a),'_',num2str(t)]];
    end
    %节点电压约束
    con=con+[(V_2_MIN-V_2(:,t)<=0):['pi_vol_down_',num2str(t)]];
    con=con+[(V_2(:,t)-V_2_MAX<=0):['pi_vol_up_',num2str(t)]];
    %参考节点相角
    con=con+[(theta(ref,t)-theta_ref==0):['pi_angle_ref_',num2str(t)]];
end

%%---- 目标函数（总成本最小） -----------------------------------------------
obj=sum(P(:,:),2)'*gencost(1:ng,COST+1)+sum(Q(:,:),2)'*gencost(ng+1:2*ng,COST+1);%+sum(Pfabs(:,:),2)'*branch(:,end);%+sum(Q_abs(:,:),2)'*gencost(:,COST+1);

%% ---- 求解 ---------------------------------------------------------------
%设置参数
ses=sdpsettings('solver','cplex');
%计算
dd=solvesdp(con,obj,ses);
if dd.problem~=0
    error('模型不可行!');
end
%% ---- 结果数据 ------------------------------------------------------------
V=double(V_2).^0.5;
theta=double(theta);
P=double(P);
Q=double(Q);
obj=double(obj);
%%----- 电价计算 ----------------------------------------------------------
%%runopf
lamda_p=[];
lamda_q=[];
for t=1:nt
    lamda_p=[lamda_p,dual(con(['lamda_p_',num2str(t)]))];
    lamda_q=[lamda_q,dual(con(['lamda_q_',num2str(t)]))];
end
%%---- 更正电压相角 -------------------------------------------------------
mpc.bus(:,VM) = V;
mpc.bus(:,VA) = theta/pi*180;
mpc.gen(:,PG) = P;
mpc.gen(:,QG) = Q;
mpc.gen(:,VG) = Vgen_bus'*V;
[MVAbase, bus, gen, branch, success, et] = runpf(mpc);
obj = gen(:,PG)'*gencost(1:ng,COST+1)+gen(:,QG)'*gencost(ng+1:2*ng,COST+1);
